<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Verified Proxy Server Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .response-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .trust-icons {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .icon-item {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        .icon-item:hover {
            transform: scale(1.05);
        }

        .icon-item.high {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .icon-item.uncertain {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .icon-item.warning {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .icon-item.error {
            background: #f8d7da;
            border: 2px solid #721c24;
        }

        .icon-symbol {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .icon-label {
            font-weight: 600;
            color: #333;
        }

        .icon-desc {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.loading {
            background: #d1ecf1;
            color: #0c5460;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Cross-Verified Proxy Server</h1>
            <p>ë‹¤ì¤‘ ê²€ì¦ ì—”ì§„ í†µí•© í…ŒìŠ¤íŠ¸ ì¸í„°í˜ì´ìŠ¤ v9.8.4</p>
        </div>

        <div class="content">
            <!-- Trust Score Icons (ë¶€ë¶„ ì‹ ë¢°ë„ í‘œì‹œ) -->
            <div class="section">
                <h2>ğŸ“Š ë¶€ë¶„ ì‹ ë¢°ë„ í‘œì‹œ ì•„ì´ì½˜</h2>
                <div class="trust-icons">
                    <div class="icon-item high">
                        <div class="icon-symbol">ğŸŸ¢</div>
                        <div class="icon-label">ë†’ì€ ì‹ ë¢°ë„</div>
                        <div class="icon-desc">TruthScore â‰¥ 90%</div>
                    </div>
                    <div class="icon-item uncertain">
                        <div class="icon-symbol">â”</div>
                        <div class="icon-label">ë¶ˆí™•ì‹¤</div>
                        <div class="icon-desc">70% â‰¤ TruthScore < 90%</div>
                    </div>
                    <div class="icon-item warning">
                        <div class="icon-symbol">âš ï¸</div>
                        <div class="icon-label">ê²½ê³ </div>
                        <div class="icon-desc">50% â‰¤ TruthScore < 70%</div>
                    </div>
                    <div class="icon-item error">
                        <div class="icon-symbol">âŒ</div>
                        <div class="icon-label">ë‚®ì€ ì‹ ë¢°ë„</div>
                        <div class="icon-desc">TruthScore < 50%</div>
                    </div>
                </div>
            </div>

            <!-- Server Configuration -->
            <div class="section">
                <h2>âš™ï¸ ì„œë²„ ì„¤ì •</h2>
                <div class="form-group">
                    <label for="serverUrl">Proxy ì„œë²„ URL</label>
                    <input type="text" id="serverUrl" value="http://localhost:3000" placeholder="http://localhost:3000">
                </div>
                <div class="form-group">
                    <label for="accessToken">Access Token (ì„ íƒ)</label>
                    <input type="text" id="accessToken" placeholder="JWT Access Token">
                </div>
                <button onclick="testHealthCheck()">Health Check í…ŒìŠ¤íŠ¸</button>
                <div class="response-box" id="healthResponse"></div>
            </div>

            <!-- Gemini API Test -->
            <div class="section">
                <h2>ğŸ¤– Gemini API í…ŒìŠ¤íŠ¸</h2>
                <div class="form-group">
                    <label for="geminiKey">Gemini API Key</label>
                    <input type="password" id="geminiKey" placeholder="AIzaSy...">
                </div>
                <div class="form-group">
                    <label for="geminiModel">ëª¨ë¸ ì„ íƒ</label>
                    <select id="geminiModel">
                        <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Exp</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash 8B</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="geminiPrompt">í”„ë¡¬í”„íŠ¸</label>
                    <textarea id="geminiPrompt" placeholder="ì•ˆë…•í•˜ì„¸ìš”, Gemini!">ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì–´ë•Œìš”?</textarea>
                </div>
                <button onclick="testGemini()">Gemini í˜¸ì¶œ</button>
                <div class="response-box" id="geminiResponse"></div>
            </div>

            <!-- K-Law API Test -->
            <div class="section">
                <h2>âš–ï¸ K-Law API í…ŒìŠ¤íŠ¸</h2>
                <div class="form-group">
                    <label for="klawTarget">ê²€ìƒ‰ ëŒ€ìƒ</label>
                    <select id="klawTarget">
                        <option value="law">ë²•ë ¹ (law)</option>
                        <option value="statute">ë²•ë¥  ì¡°ë¬¸ (statute)</option>
                        <option value="precedent">íŒë¡€ (precedent)</option>
                        <option value="adminRul">í–‰ì •ê·œì¹™ (adminRul)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="klawQuery">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="klawQuery" value="í—Œë²•" placeholder="í—Œë²•">
                </div>
                <button onclick="testKLaw()">K-Law ê²€ìƒ‰</button>
                <div class="response-box" id="klawResponse"></div>
            </div>

            <!-- External Engines Test -->
            <div class="section">
                <h2>ğŸ” ì™¸ë¶€ ê²€ì¦ ì—”ì§„ í…ŒìŠ¤íŠ¸</h2>
                <div class="form-group">
                    <label for="externalEngine">ì—”ì§„ ì„ íƒ</label>
                    <select id="externalEngine">
                        <option value="crossref">CrossRef (í•™ìˆ  ë…¼ë¬¸)</option>
                        <option value="openalex">OpenAlex (í•™ìˆ  ë°ì´í„°)</option>
                        <option value="gdelt">GDELT (ë‰´ìŠ¤ ì´ë²¤íŠ¸)</option>
                        <option value="wikidata">Wikidata (ì§€ì‹ ê·¸ë˜í”„)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="externalQuery">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="externalQuery" value="artificial intelligence" placeholder="artificial intelligence">
                </div>
                <button onclick="testExternal()">ì™¸ë¶€ ì—”ì§„ í˜¸ì¶œ</button>
                <div class="response-box" id="externalResponse"></div>
            </div>

            <!-- Batch Verification Test -->
            <div class="section">
                <h2>âš¡ ë³‘ë ¬ ë°°ì¹˜ ê²€ì¦ í…ŒìŠ¤íŠ¸</h2>
                <div class="info-box">
                    <strong>Core Logic Engine:</strong> ì—¬ëŸ¬ ê²€ì¦ ì—”ì§„ì„ ë™ì‹œì— í˜¸ì¶œí•˜ì—¬ ê²°ê³¼ë¥¼ í†µí•©í•©ë‹ˆë‹¤.
                </div>
                <div class="form-group">
                    <label for="batchQuery">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="batchQuery" value="climate change" placeholder="climate change">
                </div>
                <div class="form-group">
                    <label>ê²€ì¦ ì—”ì§„ ì„ íƒ</label>
                    <div>
                        <input type="checkbox" id="engineCrossref" checked> CrossRef
                        <input type="checkbox" id="engineOpenalex" checked> OpenAlex
                        <input type="checkbox" id="engineGdelt" checked> GDELT
                        <input type="checkbox" id="engineWikidata" checked> Wikidata
                    </div>
                </div>
                <button onclick="testBatch()">ë°°ì¹˜ ê²€ì¦ ì‹¤í–‰</button>
                <div class="response-box" id="batchResponse"></div>
            </div>

            <!-- Trust Score Calculator -->
            <div class="section">
                <h2>ğŸ“ˆ TruthScore ì‹œë®¬ë ˆì´í„°</h2>
                <div class="info-box">
                    ê° ì—”ì§„ì˜ ì‹ ë¢°ë„ ê°’ì„ ì…ë ¥í•˜ì—¬ TruthScoreë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label>CrossRef (ì´ˆê¸° ê°€ì¤‘ì¹˜: 0.25)</label>
                        <input type="number" id="scoreCrossref" min="0" max="1" step="0.1" value="0.9">
                    </div>
                    <div class="form-group">
                        <label>OpenAlex (ì´ˆê¸° ê°€ì¤‘ì¹˜: 0.20)</label>
                        <input type="number" id="scoreOpenalex" min="0" max="1" step="0.1" value="0.85">
                    </div>
                    <div class="form-group">
                        <label>GDELT (ì´ˆê¸° ê°€ì¤‘ì¹˜: 0.15)</label>
                        <input type="number" id="scoreGdelt" min="0" max="1" step="0.1" value="0.75">
                    </div>
                    <div class="form-group">
                        <label>Wikidata (ì´ˆê¸° ê°€ì¤‘ì¹˜: 0.13)</label>
                        <input type="number" id="scoreWikidata" min="0" max="1" step="0.1" value="0.80">
                    </div>
                    <div class="form-group">
                        <label>Naver (ì´ˆê¸° ê°€ì¤‘ì¹˜: 0.12)</label>
                        <input type="number" id="scoreNaver" min="0" max="1" step="0.1" value="0.70">
                    </div>
                </div>
                <button onclick="calculateTruthScore()">TruthScore ê³„ì‚°</button>
                <div class="response-box" id="truthScoreResult"></div>
            </div>
        </div>
    </div>

    <script>
        // Helper: API í˜¸ì¶œ
        async function apiCall(endpoint, options = {}) {
            const serverUrl = document.getElementById('serverUrl').value;
            const accessToken = document.getElementById('accessToken').value;

            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (accessToken) {
                headers['Authorization'] = `Bearer ${accessToken}`;
            }

            try {
                const response = await fetch(`${serverUrl}${endpoint}`, {
                    ...options,
                    headers
                });

                const data = await response.json();
                return { success: response.ok, status: response.status, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Helper: ì‘ë‹µ í‘œì‹œ
        function displayResponse(elementId, result) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

        // Health Check
        async function testHealthCheck() {
            displayResponse('healthResponse', { status: 'loading...' });
            const result = await apiCall('/health');
            displayResponse('healthResponse', result);
        }

        // Gemini API
        async function testGemini() {
            const key = document.getElementById('geminiKey').value;
            const model = document.getElementById('geminiModel').value;
            const prompt = document.getElementById('geminiPrompt').value;

            if (!key) {
                alert('Gemini API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            displayResponse('geminiResponse', { status: 'loading...' });

            // ë¨¼ì € Key ë“±ë¡
            await apiCall('/proxy/gemini/keys', {
                method: 'POST',
                body: JSON.stringify({ apiKey: key, keyIndex: 1 })
            });

            // Gemini í˜¸ì¶œ
            const result = await apiCall(`/proxy/gemini/${model}`, {
                method: 'POST',
                body: JSON.stringify({
                    keyIndex: 1,
                    contents: [{
                        role: 'user',
                        parts: [{ text: prompt }]
                    }]
                })
            });

            displayResponse('geminiResponse', result);
        }

        // K-Law API
        async function testKLaw() {
            const target = document.getElementById('klawTarget').value;
            const query = document.getElementById('klawQuery').value;

            displayResponse('klawResponse', { status: 'loading...' });

            const result = await apiCall(`/proxy/klaw/${target}?query=${encodeURIComponent(query)}&display=5`);
            displayResponse('klawResponse', result);
        }

        // External Engines
        async function testExternal() {
            const engine = document.getElementById('externalEngine').value;
            const query = document.getElementById('externalQuery').value;

            displayResponse('externalResponse', { status: 'loading...' });

            let endpoint = `/proxy/external/${engine}?query=${encodeURIComponent(query)}`;
            if (engine === 'crossref') {
                endpoint += '&email=test@example.com';
            }

            const result = await apiCall(endpoint);
            displayResponse('externalResponse', result);
        }

        // Batch Verification
        async function testBatch() {
            const query = document.getElementById('batchQuery').value;
            const engines = [];

            if (document.getElementById('engineCrossref').checked) engines.push('crossref');
            if (document.getElementById('engineOpenalex').checked) engines.push('openalex');
            if (document.getElementById('engineGdelt').checked) engines.push('gdelt');
            if (document.getElementById('engineWikidata').checked) engines.push('wikidata');

            displayResponse('batchResponse', { status: 'loading...' });

            const result = await apiCall('/proxy/external/batch', {
                method: 'POST',
                body: JSON.stringify({ query, engines })
            });

            displayResponse('batchResponse', result);
        }

        // TruthScore Calculator
        function calculateTruthScore() {
            const weights = {
                crossref: 0.25,
                openalex: 0.20,
                gdelt: 0.15,
                wikidata: 0.13,
                naver: 0.12
            };

            const scores = {
                crossref: parseFloat(document.getElementById('scoreCrossref').value),
                openalex: parseFloat(document.getElementById('scoreOpenalex').value),
                gdelt: parseFloat(document.getElementById('scoreGdelt').value),
                wikidata: parseFloat(document.getElementById('scoreWikidata').value),
                naver: parseFloat(document.getElementById('scoreNaver').value)
            };

            // TruthScore = Î£(Q_i Ã— V_i Ã— w_i) / Î£(Q_i Ã— w_i)
            // ì—¬ê¸°ì„œëŠ” Q_i = 1 (ê³µì‹ ë ¥)ë¡œ ê°€ì •
            let numerator = 0;
            let denominator = 0;

            for (const engine in scores) {
                const V = scores[engine];
                const w = weights[engine];
                const Q = 1; // ê°€ì •
                
                numerator += Q * V * w;
                denominator += Q * w;
            }

            const truthScore = numerator / denominator;
            const percentage = (truthScore * 100).toFixed(2);

            let icon = 'ğŸŸ¢';
            let label = 'ë†’ì€ ì‹ ë¢°ë„';
            let color = '#d4edda';

            if (truthScore < 0.5) {
                icon = 'âŒ';
                label = 'ë‚®ì€ ì‹ ë¢°ë„';
                color = '#f8d7da';
            } else if (truthScore < 0.7) {
                icon = 'âš ï¸';
                label = 'ê²½ê³ ';
                color = '#f8d7da';
            } else if (truthScore < 0.9) {
                icon = 'â”';
                label = 'ë¶ˆí™•ì‹¤';
                color = '#fff3cd';
            }

            const result = {
                truthScore: truthScore.toFixed(4),
                percentage: `${percentage}%`,
                icon,
                label,
                details: {
                    weights,
                    scores,
                    formula: 'TruthScore = Î£(Q_i Ã— V_i Ã— w_i) / Î£(Q_i Ã— w_i)'
                }
            };

            const element = document.getElementById('truthScoreResult');
            element.innerHTML = `
                <div style="background: ${color}; padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 64px;">${icon}</div>
                    <div style="font-size: 24px; font-weight: bold; margin: 10px 0;">${percentage}</div>
                    <div style="font-size: 18px;">${label}</div>
                </div>
                <pre style="margin-top: 20px;">${JSON.stringify(result, null, 2)}</pre>
            `;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Health Check
        window.addEventListener('load', () => {
            console.log('Cross-Verified Proxy Server Test Interface v9.8.4');
            console.log('Ready to test!');
        });
    </script>
</body>
</html>
