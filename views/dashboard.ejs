<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Cross-Verified AI ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" href="/css/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="/js/dashboard.js"></script>
</head>

<body>
  <header>
    <h1>ğŸ§­ Cross-Verified AI ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <div class="user-info">
      <span><%= user.name %> (<%= user.email %>)</span>
      <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
  </header>

  <main>
    <section class="stats">
      <div class="stat-card">
        <span>ğŸ§  í‰ê·  TruthScore</span>
        <strong><%= stats.avgTruth %></strong>
      </div>
      <div class="stat-card">
        <span>âš¡ í‰ê·  ì‘ë‹µì†ë„</span>
        <strong><%= stats.avgResponse %> ms</strong>
      </div>
      <div class="stat-card">
        <span>ğŸ“ˆ ë¡œê·¸ ìˆ˜</span>
        <strong><%= stats.count %></strong>
      </div>
    </section>

    <section class="chart">
      <h3>ğŸ“Š ìµœê·¼ TruthScore ì¶”ì´</h3>
      <canvas id="truthChart" width="600" height="250"></canvas>
    </section>

    <section class="logs">
      <h3>ğŸ—‚ ìµœê·¼ API ë¡œê·¸</h3>
      <table>
        <thead>
          <tr><th>ì‹œê°„</th><th>ì—”ì§„</th><th>TruthScore</th><th>ì‘ë‹µ(ms)</th></tr>
        </thead>
        <tbody>
          <% logs.forEach(log => { %>
          <tr>
            <td><%= new Date(log.created_at).toLocaleString() %></td>
            <td><%= log.engine %></td>
            <td><%= log.truthscore %></td>
            <td><%= log.response_time %></td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>Â© 2025 Cross-Verified AI | v14.0.0</p>
  </footer>

  <script>
    const ctx = document.getElementById('truthChart');
    const data = <%- JSON.stringify(logs.map(l => l.truthscore || 0)) %>;
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map((_, i) => i + 1),
        datasets: [{
          label: 'TruthScore',
          data,
          borderColor: '#2563eb',
          backgroundColor: 'rgba(37,99,235,0.15)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        scales: { y: { min: 0, max: 1 } },
        plugins: { legend: { display: false } }
      }
    });
  </script>
</body>
</html>
